# Import Aspect bazelrc presets
import %workspace%/.aspect/bazelrc/bazel7.bazelrc
import %workspace%/.aspect/bazelrc/convenience.bazelrc
import %workspace%/.aspect/bazelrc/correctness.bazelrc
import %workspace%/.aspect/bazelrc/debug.bazelrc
import %workspace%/.aspect/bazelrc/javascript.bazelrc
import %workspace%/.aspect/bazelrc/performance.bazelrc

### YOUR PROJECT SPECIFIC OPTIONS GO HERE ###
## Ensure that we don't accidentally build protobuf or gRPC
common --incompatible_enable_proto_toolchain_resolution

# Pass hermetic protoc to build scripts
# Use platform-specific hermetic protoc from toolchains_protoc 
build:macos --action_env=PROTOC=external/toolchains_protoc++protoc+toolchains_protoc_hub.osx_aarch_64/bin/protoc
build:linux --action_env=PROTOC=external/toolchains_protoc++protoc+toolchains_protoc_hub.linux_x86_64/bin/protoc
# Default fallback to system protoc if platform not matched
build --action_env=PROTOC=/opt/homebrew/bin/protoc
common --per_file_copt=external/.*protobuf.*@--PROTOBUF_WAS_NOT_SUPPOSED_TO_BE_BUILT
common --host_per_file_copt=external/.*protobuf.*@--PROTOBUF_WAS_NOT_SUPPOSED_TO_BE_BUILT
common --per_file_copt=external/.*grpc.*@--GRPC_WAS_NOT_SUPPOSED_TO_BE_BUILT
common --host_per_file_copt=external/.*grpc.*@--GRPC_WAS_NOT_SUPPOSED_TO_BE_BUILT

build:linux --platforms=//platforms:linux_x86_64
build:macos --platforms=//platforms:darwin_arm64

# CI configuration 
build:ci --incompatible_enable_proto_toolchain_resolution
# Use hermetic CC toolchain in CI (Linux) - provides Zig-based cross-compilation
build:ci --extra_toolchains=@hermetic_cc_toolchain//toolchain:all
# On Linux, use hermetic CC for cross-compilation  
build:linux --extra_toolchains=@hermetic_cc_toolchain//toolchain:all

try-import %workspace%/.aspect/bazelrc/user.bazelrc
